var config = require('./config'),    express = require('express'),    morgan = require('morgan'),    bodyParser = require('body-parser'),    methodOverride = require('method-override'),    session = require('express-session'),    flash = require('connect-flash'),    passport = require('passport');    module.exports = function() {    //for this instance of express    var app = express();    //what to use in dev    if (process.env.NODE_ENV === 'development') {        app.use(morgan('dev'));    }     //what to do in prod    else if (process.env.NODE_ENV === 'production') {        app.set('trust proxy', 1); //because secure is set to true for sessionObject in prod     };    //stuff 'n' thangs    app.use(bodyParser.urlencoded({extended: true}));    app.use(bodyParser.json());        app.use(session(config.sessionOptions));          app.set('views', './app/views');    app.set('view engine', 'ejs');        app.use(flash());    app.use(passport.initialize());    app.use(passport.session());        require('../app/routes/app.server.routes.js')(app);        app.use(express.static('./public'));    return app;};